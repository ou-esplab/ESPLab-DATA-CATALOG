<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Model</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<h1>Model</h1>

<div>
  <label for="category">Category:</label>
  <select id="category">
    <option value="">-- Select Category --</option><option value='initialized'>initialized</option>
<option value='uninitialized'>uninitialized</option>
</select>
  <label for="project">Project:</label>
  <select id="project" disabled>
    <option value="">-- Select Project --</option>
  </select>

  <label for="experiment">Experiment:</label>
  <select id="experiment" disabled>
    <option value="">-- Select Experiment --</option>
  </select>

  <label for="variable">Variable:</label>
  <select id="variable" disabled>
    <option value="">-- Select Variable --</option>
  </select>

  <label for="tempres">Temporal Resolution:</label>
  <select id="tempres" disabled>
    <option value="">-- Select Temporal Resolution --</option>
  </select>
</div>

<div id="datasetList"></div>

<script>
// category change
document.getElementById("category").addEventListener("change", function() {
    const category = this.value;
    const projectSelect = document.getElementById("project");
    clearAndDisable(projectSelect);
    clearAndDisable(document.getElementById("experiment"));
    clearAndDisable(document.getElementById("variable"));
    clearAndDisable(document.getElementById("tempres"));
    document.getElementById("datasetList").innerHTML = "";

    if (!category) return;

    const projects = Object.keys(catalog[category] || {});
    populateSelect(projectSelect, projects);
});

// project change
document.getElementById("project").addEventListener("change", function() {
    const category = document.getElementById("category").value;
    const project = this.value;
    const experimentSelect = document.getElementById("experiment");
    clearAndDisable(experimentSelect);
    clearAndDisable(document.getElementById("variable"));
    clearAndDisable(document.getElementById("tempres"));
    document.getElementById("datasetList").innerHTML = "";

    if (!project) return;

    const experiments = Object.keys(catalog[category][project] || {});
    populateSelect(experimentSelect, experiments);
});

// experiment change
document.getElementById("experiment").addEventListener("change", function() {
    const category = document.getElementById("category").value;
    const project = document.getElementById("project").value;
    const experiment = this.value;
    const variableSelect = document.getElementById("variable");
    const tempresSelect = document.getElementById("tempres");
    clearAndDisable(variableSelect);
    clearAndDisable(tempresSelect);
    document.getElementById("datasetList").innerHTML = "";

    if (!temporal) return;

    if (project === "nmme") {
        const variables = Object.keys(catalog[category][project][experiment][temporal] || {});
        populateSelect(variableSelect, variables);
    }
});

    if (!experiment) return;

    if (project === "subx") {
        // keys: [variable]
        const variables = Object.keys(catalog[category][project][experiment] || {});
        populateSelect(variableSelect, variables);
    }
    else if (project === "nmme") {
        // keys: [temporal]
        const temporals = Object.keys(catalog[category][project][experiment] || {});
        populateSelect(tempresSelect, temporals);
    }
    else if (project === "NCAR-CESM2-CLIMO") {
        // keys: [datatype]
        const datatypes = Object.keys(catalog[category][project][experiment] || {});
        populateSelect(variableSelect, datatypes);  // note using variableSelect for datatype
    }
    else if (project === "NCAR-CESM2-SMYLE") {
        // keys: [temporal]
        const temporals = Object.keys(catalog[category][project][experiment] || {});
        populateSelect(tempresSelect, temporals);
    }
});

// on temporal change for NMME
document.getElementById("tempres").addEventListener("change", function() {
    const category = document.getElementById("category").value;
    const project = document.getElementById("project").value;
    const experiment = document.getElementById("experiment").value;
    const temporal = this.value;
    const variableSelect = document.getElementById("variable");
    clearAndDisable(variableSelect);
    document.getElementById("datasetList").innerHTML = "";

    if (!temporal) return;

    if (project === "nmme") {
        const variables = Object.keys(catalog[category][project][experiment][temporal] || {});
        populateSelect(variableSelect, variables);
    }
});


// variable change
document.getElementById("variable").addEventListener("change", function() {
    const category = document.getElementById("category").value;
    const project = document.getElementById("project").value;
    const experiment = document.getElementById("experiment").value;
    const variable = this.value;
    const tempresSelect = document.getElementById("tempres");
    clearAndDisable(tempresSelect);
    document.getElementById("datasetList").innerHTML = "";

    if (!variable) return;

    if (project === "NCAR-CESM2-CLIMO") {
        // now get variable names under datatype
        const variables = Object.keys(catalog[category][project][experiment][variable] || {});
        populateSelect(tempresSelect, variables);
    }
    else if (project === "subx") {
        updateDatasets();  // subx goes straight to showing entries
    }
});

// temporal change
document.getElementById("tempres").addEventListener("change", updateDatasets);

function updateDatasets() {
    const category = document.getElementById("category").value;
    const project = document.getElementById("project").value;
    const experiment = document.getElementById("experiment").value;
    const variable = document.getElementById("variable").value;
    const tempres = document.getElementById("tempres").value;

    let entries = [];
    let container = document.getElementById("datasetList");
    container.innerHTML = "";

    try {
        if (project === "subx") {
            entries = catalog[category][project][experiment][variable];
        }
        else if (project === "nmme") {
            entries = catalog[category][project][experiment][tempres][variable];
        }
        else if (project === "NCAR-CESM2-SMYLE") {
            entries = catalog[category][project][experiment][tempres];
        }
        else if (project === "NCAR-CESM2-CLIMO") {
            entries = catalog[category][project][experiment][variable][tempres];
        }
        else if (project === "nmme") {
            entries = catalog[category][project][experiment][tempres][variable];
        }
    } catch (e) {
        console.log("No matching entries");
    }

    if (!entries || entries.length === 0) {
        container.textContent = "No datasets found for this selection.";
        return;
    }

    entries.forEach(entry => {
        const div = document.createElement("div");
        div.className = "dataset-entry";
        div.innerHTML = `
            <div class="dataset-name">${entry.name}</div>
            <div><span class="meta-field">Description:</span> ${entry.long_name}</div>
            <div><span class="meta-field">Units:</span> ${entry.units}</div>
            <div><span class="meta-field">Date Range:</span> ${entry.date_range}</div>
            <div><span class="meta-field">Files:</span> ${entry.files}</div>
            <div><span class="meta-field">Data Location:</span> ${entry.data_location}</div>
        `;
        container.appendChild(div);
    });
}

</script>
</body>
</html>
